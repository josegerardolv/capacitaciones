<div class="p-8 animate-fade-in">
    <!-- Breadcrumbs -->
    <div class="text-sm text-gray-500 mb-6 font-montserrat">
        <span class="hover:text-[#8B1538] cursor-pointer" [routerLink]="['/cursos']">Cursos</span>
        <span class="mx-2">></span>
        <span class="hover:text-[#8B1538] cursor-pointer" [routerLink]="['/cursos/grupos']">Grupos</span>
        <span class="mx-2">></span>
        <span class="font-bold text-[#8B1538]">Conductores</span>
    </div>
    <!-- Header & Actions -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
        <h2 class="text-3xl font-bold text-gray-800 font-montserrat">Lista de Conductores</h2>
        <div class="flex gap-3">
            <!-- Botón Nuevo Conductor (Vino) -->
            <app-institutional-button [config]="{variant: 'primary', icon: 'add'}" (buttonClick)="openNewDriverForm()">
                Nuevo Conductor
            </app-institutional-button>
        </div>
    </div>
    <!-- Contenedor Tabla (Estilo Card) -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
        <!-- Tabla Institucional -->
        <app-institutional-table [data]="drivers" [columns]="tableColumns" [config]="tableConfig">
        </app-institutional-table>
    </div>
    <!-- Templates -->
    <!-- Estatus: Badge Aprobado/No Aprobado o Botones de Calificación -->
    <ng-template #statusTemplate let-item>
        <!-- Caso 1: Ya calificado (Mostrar Badge) -->
        <span *ngIf="item.status !== 'Pendiente'"
            class="px-3 py-1 rounded-full text-xs font-bold text-white shadow-sm inline-block min-w-[90px] text-center"
            [ngClass]="{
                'bg-emerald-500': item.status === 'Aprobado',
                'bg-red-500': item.status === 'No Aprobado'
              }">
            {{ item.status }}
        </span>
        <!-- Caso 2: Pendiente (Mostrar Acciones de Calificación) -->
        <div *ngIf="item.status === 'Pendiente'" class="flex items-center justify-center gap-2">
            <!-- Aprobar (Check Verde) -->
            <button (click)="setExamResult(item, 'Aprobado')"
                class="w-7 h-7 rounded-full bg-emerald-500 text-white flex items-center justify-center hover:bg-emerald-600 transition-colors shadow-sm"
                [appTooltip]="'Aprobar Examen'" tooltipPosition="top">
                <span class="material-symbols-outlined text-lg">check</span>
            </button>
            <!-- Reprobar (Cruz Roja) -->
            <button (click)="setExamResult(item, 'No Aprobado')"
                class="w-7 h-7 rounded-full bg-red-500 text-white flex items-center justify-center hover:bg-red-600 transition-colors shadow-sm"
                [appTooltip]="'Reprobar Examen'" tooltipPosition="top">
                <span class="material-symbols-outlined text-lg">close</span>
            </button>
        </div>
    </ng-template>
    <!-- Acciones: Botones circulares de colores -->
    <ng-template #actionsTemplate let-item>
        <div class="flex items-center justify-center gap-2">
            <!-- Constancia (Verde/Naranja) -->
            <app-institutional-button [config]="{
                    variant: item.coursePaymentStatus === 'Pagado' ? 'success' : 'warning',
                    icon: item.coursePaymentStatus === 'Pagado' ? 'description' : 'schedule',
                    iconPosition: 'only',
                    disabled: item.status !== 'Aprobado',
                    customClass: '!rounded-full !w-8 !h-8 !p-0 min-w-[unset]'
                }" (buttonClick)="item.status === 'Aprobado' && viewCertificate(item)"
                [appTooltip]="item.status === 'Aprobado' ? (item.coursePaymentStatus === 'Pagado' ? 'Descargar Constancia' : 'Pago Curso Pendiente') : 'Requiere Aprobación'"
                tooltipPosition="top">
            </app-institutional-button>

            <!-- Tarjetón (Verde/Ambar/Azul) -->
            <app-institutional-button [config]="{
                    variant: item.paymentStatus === 'Pagado' ? 'success' : (item.paymentStatus === 'Pendiente' ? 'warning' : 'info'),
                    icon: item.paymentStatus === 'Pagado' ? 'badge' : (item.paymentStatus === 'Pendiente' ? 'schedule' : 'badge'),
                    iconPosition: 'only',
                    disabled: item.status !== 'Aprobado',
                    customClass: '!rounded-full !w-8 !h-8 !p-0 min-w-[unset]'
                }" (buttonClick)="item.status === 'Aprobado' && requestTarjeton(item)"
                [appTooltip]="item.status === 'Aprobado' ? (item.paymentStatus === 'Pagado' ? 'Descargar Tarjetón' : (item.paymentStatus === 'Pendiente' ? 'Pago Pendiente' : 'Generar Tarjetón')) : 'Requiere Aprobación'"
                tooltipPosition="top">
            </app-institutional-button>

            <!-- Eliminar (Rojo) -->
            <app-institutional-button [config]="{
                    variant: 'danger',
                    icon: 'delete',
                    iconPosition: 'only',
                    customClass: '!rounded-full !w-8 !h-8 !p-0 min-w-[unset]'
                }" (buttonClick)="deleteDriver(item)" [appTooltip]="'Eliminar Conductor'" tooltipPosition="top">
            </app-institutional-button>
        </div>
    </ng-template>

    <!-- Modales Genéricos -->
    <app-confirmation-modal [isOpen]="isConfirmOpen" [config]="confirmConfig" (confirm)="onConfirmYes()"
        (cancel)="isConfirmOpen = false" (modalClose)="isConfirmOpen = false">
    </app-confirmation-modal>

    <app-alert-modal [isOpen]="isAlertOpen" [config]="alertConfig" (actionClick)="isAlertOpen = false"
        (modalClose)="isAlertOpen = false">
    </app-alert-modal>
</div>