<div class="p-6 bg-gray-50 min-h-screen">

    <div class="bg-white rounded-3xl shadow-sm border border-gray-100 p-8 min-h-[600px] relative">

        <!-- Breadcrumb & Header -->
        <div class="mb-8">
            <div class="text-sm text-gray-500 mb-1 flex items-center gap-1">
                <a [routerLink]="['/cursos']" class="hover:text-[#8B1538] transition-colors cursor-pointer">Cursos</a>
                <span>&gt;</span>
                <span class="text-[#8B1538] font-bold">Grupos</span>
            </div>
            <h2 class="text-2xl font-bold text-gray-800">Lista de Grupos</h2>
        </div>

        <!-- Toolbar -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">

            <!-- Selection Actions (Left) -->
            <div class="flex items-center gap-2">
                <!-- Placeholder for broader selection logic if needed -->
                <!-- <input type="checkbox" class="rounded border-gray-300 text-[#8B1538] focus:ring-[#8B1538]" 
                        [checked]="allSelected" (change)="toggleSelectAll()">
                 <span class="text-sm text-gray-600">Seleccionar todos</span> -->
            </div>

            <!-- Action Buttons (Right) -->
            <div class="flex items-center gap-3">

                <app-institutional-button [config]="{ 
                        variant: 'primary', 
                        icon: 'file_download', 
                        customClass: '!bg-[#8B1538]',
                        disabled: selectedGroups.length === 0 
                    }" (buttonClick)="exportData()">
                    Exportar
                </app-institutional-button>

                <app-institutional-button [config]="{ 
                        variant: 'primary', 
                        icon: 'link', 
                        customClass: '!bg-[#8B1538]',
                        disabled: selectedGroups.length !== 1
                    }" (buttonClick)="generateUrl()">
                    Generar URL
                </app-institutional-button>

                <app-institutional-button [config]="{ variant: 'primary', icon: 'add', customClass: '!bg-[#8B1538]' }"
                    (buttonClick)="openNewGroupForm()">
                    Nuevo Grupo
                </app-institutional-button>

            </div>
        </div>

        <app-table-pagination [config]="paginationConfig" [showPageSizeSelector]="true" [showPaginationControls]="false"
            (pageChange)="onPageChange($event)">
        </app-table-pagination>
        <!-- Institutional Table -->
        <app-institutional-table [data]="groups" [columns]="tableColumns" [config]="tableConfig"
            [selectedItems]="selectedGroups" (selectionChange)="onSelectionChange($event)">
        </app-institutional-table>

        <!-- Pagination -->
        <app-table-pagination [config]="paginationConfig" [showPageSizeSelector]="false" [showPaginationControls]="true"
            (pageChange)="onPageChange($event)">
        </app-table-pagination>

    </div>
</div>

<!-- Templates -->

<!-- Link Template (Copy URL) -->
<ng-template #urlTemplate let-item>
    <div class="flex justify-center" *ngIf="item.url">
        <button
            class="w-8 h-8 rounded-full bg-blue-100 text-blue-800 hover:bg-blue-200 flex items-center justify-center transition-colors"
            [appTooltip]="'Copiar Enlace'" tooltipPosition="top" (click)="copyUrl(item.url); $event.stopPropagation()">
            <span class="material-symbols-outlined text-sm">content_copy</span>
        </button>
    </div>
    <div *ngIf="!item.url" class="text-gray-400 text-xs italic text-center">
        Sin enlace
    </div>
</ng-template>

<!-- Status Template -->
<ng-template #statusTemplate let-status="value">
    <div class="flex items-center justify-center">
        <span class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [ngClass]="{
                'bg-green-100 text-green-700': status === 'Activo',
                'bg-gray-100 text-gray-500': status === 'Inactivo'
            }">
            <span class="w-1.5 h-1.5 rounded-full"
                [ngClass]="{'bg-green-500': status === 'Activo', 'bg-gray-400': status === 'Inactivo'}">
            </span>
            {{ status }}
        </span>
    </div>
</ng-template>

<!-- Actions Template -->
<ng-template #actionsTemplate let-item>
    <div class="flex items-center justify-center space-x-2">
        <!-- Requests Button (Moved here) -->
        <button
            class="hidden md:flex items-center justify-center px-2 py-1 rounded border border-[#00C895] text-[#00C895] hover:bg-green-50 transition-colors text-xs gap-1"
            [appTooltip]="'Gestionar Solicitudes'" tooltipPosition="top"
            (click)="openRequests(item); $event.stopPropagation()">
            <span class="font-bold">{{ item.requests || 0 }}</span>
            <app-universal-icon name="person-check" type="bootstrap" [size]="14"></app-universal-icon>
        </button>

        <!-- View Details -->
        <app-institutional-button [config]="{
                variant: 'info',
                icon: 'list_alt',
                iconPosition: 'only',
                customClass: '!rounded-full !w-8 !h-8 !p-0 min-w-[unset]'
            }" (buttonClick)="viewDrivers(item); $event.stopPropagation()" [appTooltip]="'Ver conductores'"
            tooltipPosition="top">
        </app-institutional-button>

        <!-- Edit -->
        <app-institutional-button [config]="{
                variant: 'warning',
                icon: 'edit',
                iconPosition: 'only',
                customClass: '!rounded-full !w-8 !h-8 !p-0 min-w-[unset]'
            }" (buttonClick)="openEditGroupForm(item)" [appTooltip]="'Editar'" tooltipPosition="top">
        </app-institutional-button>

        <!-- Delete -->
        <app-institutional-button [config]="{
                variant: 'danger',
                icon: 'delete',
                iconPosition: 'only',
                customClass: '!rounded-full !w-8 !h-8 !p-0 min-w-[unset]'
            }" (buttonClick)="deleteGroup(item.id)" [appTooltip]="'Eliminar'" tooltipPosition="top">
        </app-institutional-button>
    </div>
</ng-template>

<!-- Modals -->
<app-group-form [isOpen]="isNewGroupModalOpen" [group]="editingGroup" (close)="isNewGroupModalOpen = false"
    (saved)="onGroupSaved()">
</app-group-form>

<app-group-requests [isOpen]="isRequestsModalOpen" [group]="selectedRequestGroup" (close)="isRequestsModalOpen = false">
</app-group-requests>

<!-- Modales GenÃ©ricos -->
<app-confirmation-modal [isOpen]="isConfirmOpen" [config]="confirmConfig" (confirm)="onConfirmYes()"
    (cancel)="isConfirmOpen = false" (modalClose)="isConfirmOpen = false">
</app-confirmation-modal>

<app-alert-modal [isOpen]="isAlertOpen" [config]="alertConfig" (actionClick)="isAlertOpen = false"
    (modalClose)="isAlertOpen = false">
</app-alert-modal>