<div class="min-h-screen">

    <!-- Tarjeta superior: título y breadcrumb -->
    <app-institutional-card [config]="{ showHeader: false, showFooter: false, showShadow: true, showBorder: true }" class="mb-6">
        <div class="flex items-center gap-4">
            <div class="p-3 rounded-lg bg-institucional-primario bg-opacity-10 flex items-center justify-center">
                <app-universal-icon name="person_text" type="material" class="w-6 h-6 text-white"></app-universal-icon> 
            </div>

            <div class="min-w-0">
                <h1 class="text-2xl md:text-3xl font-extrabold text-gray-900">Lista de Personas</h1>
                <p class="text-sm text-gray-500 mt-1">Gestiona las personas del grupo</p>
            </div>
        </div>

        <div class="mt-2 ml-4">
            <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>
        </div>
    </app-institutional-card>
    <br>

    <!-- Tarjeta inferior: acciones, tabla y paginación -->
    <app-institutional-card [config]="{ showHeader: false, showFooter: false, showShadow: true, showBorder: true }">
        <!-- Toolbar: paginación superior y botón crear -->
        <div class="flex flex-col-reverse md:flex-row md:justify-between md:items-center gap-4">
            <app-table-pagination
                [config]="paginationConfig"
                [showPageSizeSelector]="true"
                [showPaginationControls]="false"
                (pageChange)="onPageChange($event)">
            </app-table-pagination>

            <div class="flex flex-col md:flex-row md:items-center gap-2">
                <app-institutional-button (buttonClick)="openNewDriverForm()" [config]="{
                    variant: 'primary',
                    icon: 'add'
                }">
                    Nueva Persona
                </app-institutional-button>
            </div>
        </div>

        <!-- Tabla -->
        <app-institutional-table
            [data]="drivers"
            [columns]="tableColumns"
            [config]="tableConfig">
        </app-institutional-table>

        <!-- Paginación inferior -->
        <div class="mt-4">
            <app-table-pagination
                [config]="paginationConfig"
                [showPageSizeSelector]="false"
                [showPaginationControls]="true"
                (pageChange)="onPageChange($event)">
            </app-table-pagination>
        </div>

    </app-institutional-card>
    <!-- Templates -->
    <!-- Estatus: Badge Aprobado/No Aprobado o Botones de Calificación -->
    <ng-template #statusTemplate let-item>
        <!-- Caso 1: Ya calificado (Mostrar Badge) -->
        <span *ngIf="item.status !== 'Pendiente'"
            class="px-3 py-1 rounded-full text-xs font-bold text-white shadow-sm inline-block min-w-[90px] text-center"
            [ngClass]="{
                'bg-emerald-500': item.status === 'Aprobado',
                'bg-red-500': item.status === 'No Aprobado'
              }">
            {{ item.status }}
        </span>
        <!-- Caso 2: Pendiente (Mostrar Acciones de Calificación) -->
        <div *ngIf="item.status === 'Pendiente'" class="flex items-center justify-center gap-2">
            <!-- Aprobar (Check Verde) -->
            <button (click)="setExamResult(item, 'Aprobado')"
                class="w-7 h-7 rounded-full bg-emerald-500 text-white flex items-center justify-center hover:bg-emerald-600 transition-colors shadow-sm"
                [appTooltip]="'Aprobar Examen'" tooltipPosition="top">
                <span class="material-symbols-outlined text-lg">check</span>
            </button>
            <!-- Reprobar (Cruz Roja) -->
            <button (click)="setExamResult(item, 'No Aprobado')"
                class="w-7 h-7 rounded-full bg-red-500 text-white flex items-center justify-center hover:bg-red-600 transition-colors shadow-sm"
                [appTooltip]="'Reprobar Examen'" tooltipPosition="top">
                <span class="material-symbols-outlined text-lg">close</span>
            </button>
        </div>
    </ng-template>
    <!-- Acciones: Botones circulares de colores -->
    <ng-template #actionsTemplate let-item>
        <div class="flex items-center justify-center gap-2">
            <!-- Constancia (Verde/Naranja) -->
            <app-institutional-button [config]="{
                    variant: item.coursePaymentStatus === 'Pagado' ? 'success' : 'warning',
                    icon: 'description',
                    iconPosition: 'only',
                    disabled: item.status !== 'Aprobado',
                    customClass: '!rounded-full !w-8 !h-8 !p-0 min-w-[unset]'
                }" (buttonClick)="item.status === 'Aprobado' && viewCertificate(item)"
                [appTooltip]="item.status === 'Aprobado' ? (item.coursePaymentStatus === 'Pagado' ? 'Descargar Constancia' : 'Pago Curso Pendiente') : 'Requiere Aprobación'"
                tooltipPosition="top">
            </app-institutional-button>

            <!-- Tarjetón (Verde/Ambar/Azul) -->
            <app-institutional-button [config]="{
                    variant: item.paymentStatus === 'Pagado' ? 'success' : (item.paymentStatus === 'Pendiente' ? 'warning' : 'info'),
                    icon: 'badge',
                    iconPosition: 'only',
                    disabled: item.status !== 'Aprobado',
                    customClass: '!rounded-full !w-8 !h-8 !p-0 min-w-[unset]'
                }" (buttonClick)="item.status === 'Aprobado' && requestTarjeton(item)"
                [appTooltip]="item.status === 'Aprobado' ? (item.paymentStatus === 'Pagado' ? 'Descargar Tarjetón' : (item.paymentStatus === 'Pendiente' ? 'Pago Pendiente' : 'Generar Tarjetón')) : 'Requiere Aprobación'"
                tooltipPosition="top">
            </app-institutional-button>

            <!-- Eliminar (Rojo) -->
            <app-institutional-button [config]="{
                    variant: 'danger',
                    icon: 'delete',
                    iconPosition: 'only',
                    customClass: '!rounded-full !w-8 !h-8 !p-0 min-w-[unset]'
                }" (buttonClick)="deleteDriver(item)" [appTooltip]="'Eliminar Conductor'" tooltipPosition="top">
            </app-institutional-button>
        </div>
    </ng-template>

    <!-- Modales Genéricos -->
    <app-confirmation-modal [isOpen]="isConfirmOpen" [config]="confirmConfig" (confirm)="onConfirmYes()"
        (cancel)="isConfirmOpen = false" (modalClose)="isConfirmOpen = false">
    </app-confirmation-modal>

    <app-alert-modal [isOpen]="isAlertOpen" [config]="alertConfig" (actionClick)="isAlertOpen = false"
        (modalClose)="isAlertOpen = false">
    </app-alert-modal>
</div>