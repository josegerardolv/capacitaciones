<div class="min-h-screen">

    <!-- Tarjeta superior: título y breadcrumb -->
    <app-institutional-card [config]="{ showHeader: false, showFooter: false, showShadow: true, showBorder: true }" class="mb-6">
        <div class="flex items-center gap-4">
            <div class="p-3 rounded-lg bg-institucional-primario bg-opacity-10 flex items-center justify-center">
                <app-universal-icon name="groups" type="material" class="w-6 h-6 text-white"></app-universal-icon> 
            </div>

            <div class="min-w-0">
                <h1 class="text-2xl md:text-3xl font-extrabold text-gray-900">Lista de Grupos</h1>
                <p class="text-sm text-gray-500 mt-1">Gestiona los grupos y cursos asociados</p>
            </div>
        </div>

        <div class="mt-2 ml-4">
            <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>
        </div>
    </app-institutional-card>
    <br>
    <!-- Tarjeta inferior: acciones, tabla y paginación -->
    <app-institutional-card [config]="{ showHeader: false, showFooter: false, showShadow: true, showBorder: true }">
        <!-- Toolbar: paginación superior y botón crear -->
        <div class="flex flex-col-reverse md:flex-row md:justify-between md:items-center gap-4">
            <app-table-pagination
                [config]="paginationConfig"
                [showPageSizeSelector]="true"
                [showPaginationControls]="false"
                (pageChange)="onPageChange($event)">
            </app-table-pagination>

            <div class="flex flex-col md:flex-row md:items-center gap-2">
                <app-institutional-button (buttonClick)="openForm()" [config]="{
                    variant: 'primary',
                    icon: 'add'
                }">
                    Nuevo Grupo
                </app-institutional-button>
            </div>
        </div>

        <!-- Tabla -->
        <app-institutional-table
            [data]="groups" 
            [columns]="tableColumns" 
            [config]="tableConfig">
        </app-institutional-table>

        <!-- Paginación inferior -->
        <div class="mt-4">
            <app-table-pagination
                [config]="paginationConfig"
                [showPageSizeSelector]="false"
                [showPaginationControls]="true"
                (pageChange)="onPageChange($event)">
            </app-table-pagination>
        </div>

    </app-institutional-card>
</div>

<app-modal-form 
    [isOpen]="showModal" 
    [title]="modalMode === 'create' ? 'Nuevo Grupo' : 'Editar Grupo'" 
    (modalClose)="closeModal()" 
    (formSubmit)="onGroupModalSubmit()"
    [formGroup]="groupModalForm"
    [isLoading]="isSaving">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Nombre del Grupo -->
        <div class="col-span-1">
            <app-input-enhanced controlName="name" [control]="groupModalForm.get('name')" label="Nombre del Grupo"
                placeholder="Ingresa el nombre del grupo" [required]="true">
            </app-input-enhanced>
        </div>

        <!-- Descripción del grupo -->
        <div class="col-span-1">
            <app-input-enhanced controlName="description" [control]="groupModalForm.get('description')"
                label="Descripción del grupo" placeholder="Ingresa la descripción del grupo" [required]="true">
            </app-input-enhanced>
        </div>

        <!-- Curso Asociado -->
        <div class="col-span-1">
            <app-input-enhanced controlName="course" [control]="groupModalForm.get('course')" label="Curso Asociado"
                placeholder="Ingresa el curso asociado" [required]="true">
            </app-input-enhanced>
        </div>
    </div>
</app-modal-form>

<app-group-requests
    [isOpen]="isRequestsModalOpen"
    [group]="selectedRequestGroup"
    (close)="isRequestsModalOpen = false">
</app-group-requests>

<!-- Template para Acciones -->
<ng-template #actionsTemplate let-item>
    <div class="flex items-center justify-center space-x-3">
        <app-institutional-button [config]="{
                variant: 'info',
                size: 'small', 
                icon: 'list_alt',
                iconPosition: 'only'}" 
                [appTooltip]="'Ver detalles'" tooltipPosition="top"
                (buttonClick)="viewDrivers(item)" >
        </app-institutional-button>
        <div class="relative">
            <app-institutional-button [config]="{
                variant: 'secondary',
                size: 'small', 
                icon: 'patient_list',
                iconPosition: 'only'}" 
                (buttonClick)="openRequests(item)">
            </app-institutional-button>
            <span *ngIf="item.requests > 0" class="absolute -top-2 -right-2 inline-flex items-center justify-center bg-red-600 text-white text-xs font-semibold rounded-full px-2 py-0.5">{{ item.requests }}</span>
        </div>
        <app-institutional-button [config]="{
                variant: 'warning',
                size: 'small', 
                icon: 'edit',
                iconPosition: 'only'}" 
                [appTooltip]="'Editar'" tooltipPosition="top"
                (buttonClick)="openEditForm(item)">
        </app-institutional-button>
        <app-institutional-button [config]="{
                variant: 'danger',
                size: 'small', 
                icon: 'delete',
                iconPosition: 'only'}" 
            [appTooltip]="'Eliminar'" tooltipPosition="top"
            (buttonClick)="deleteGroup(item.id)">
        </app-institutional-button>
    </div>
</ng-template>

<!-- Modales Genéricos -->
<app-confirmation-modal [isOpen]="isConfirmOpen" [config]="confirmConfig" (confirm)="onConfirmYes()"
    (cancel)="isConfirmOpen = false" (modalClose)="isConfirmOpen = false">
</app-confirmation-modal>
<app-alert-modal [isOpen]="isAlertOpen" [config]="alertConfig" (actionClick)="isAlertOpen = false"
    (modalClose)="isAlertOpen = false">
</app-alert-modal>