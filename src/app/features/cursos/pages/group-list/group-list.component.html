<div class="p-6 bg-gray-50 min-h-screen">

    <div class="bg-white rounded-3xl shadow-sm border border-gray-100 p-8 min-h-[600px] relative">

        <!-- Breadcrumb & Header -->
        <div class="mb-8">
            <div class="text-sm text-gray-500 mb-1 flex items-center gap-1">
                <a [routerLink]="['/cursos']" class="hover:text-[#8B1538] transition-colors cursor-pointer">Cursos</a>
                <span>&gt;</span>
                <span class="text-[#8B1538] font-bold">Grupos</span>
            </div>
            <h2 class="text-2xl font-bold text-gray-800">Lista de Grupos</h2>
        </div>

        <!-- Toolbar -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">

            <!-- Selection Actions (Left) -->
            <div class="flex items-center gap-2">
                <!-- Placeholder for broader selection logic if needed -->
                <!-- <input type="checkbox" class="rounded border-gray-300 text-[#8B1538] focus:ring-[#8B1538]" 
                        [checked]="allSelected" (change)="toggleSelectAll()">
                 <span class="text-sm text-gray-600">Seleccionar todos</span> -->
            </div>

            <!-- Action Buttons (Right) -->
            <div class="flex items-center gap-3">

                <app-institutional-button [config]="{ 
                        variant: 'primary', 
                        icon: 'file_download', 
                        customClass: '!bg-[#8B1538]',
                        disabled: selectedGroups.length === 0 
                    }" (buttonClick)="exportData()">
                    Exportar
                </app-institutional-button>

                <app-institutional-button [config]="{ 
                        variant: 'primary', 
                        icon: 'link', 
                        customClass: '!bg-[#8B1538]',
                        disabled: selectedGroups.length !== 1
                    }" (buttonClick)="generateUrl()">
                    Generar URL
                </app-institutional-button>

                <app-institutional-button [config]="{ variant: 'primary', icon: 'add', customClass: '!bg-[#8B1538]' }"
                    (buttonClick)="openNewGroupForm()">
                    Nuevo Grupo
                </app-institutional-button>

            </div>
        </div>

        <!-- Institutional Table -->
        <app-institutional-table [data]="groups" [columns]="tableColumns" [config]="tableConfig"
            [selectedItems]="selectedGroups" (selectionChange)="onSelectionChange($event)">
        </app-institutional-table>

        <!-- Pagination -->
        <app-table-pagination [config]="paginationConfig" (pageChange)="onPageChange($event)">
        </app-table-pagination>

    </div>
</div>

<!-- Templates -->

<!-- Link Template (Copy URL) -->
<ng-template #urlTemplate let-item>
    <div class="flex justify-center" *ngIf="item.url">
        <button
            class="flex items-center justify-center w-8 h-8 rounded-full bg-indigo-50 text-indigo-600 border border-indigo-200 hover:bg-[#8B1538] hover:text-white hover:border-[#8B1538] transition-colors shadow-sm"
            title="Copiar Enlace" (click)="copyUrl(item.url); $event.stopPropagation()">
            <app-universal-icon name="copy" type="bootstrap" [size]="14"></app-universal-icon>
        </button>
    </div>
    <div *ngIf="!item.url" class="text-gray-400 text-xs italic text-center">
        Sin enlace
    </div>
</ng-template>

<!-- Status Template -->
<ng-template #statusTemplate let-status="value">
    <div class="flex items-center justify-center">
        <span class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [ngClass]="{
                'bg-green-100 text-green-700': status === 'Activo',
                'bg-gray-100 text-gray-500': status === 'Inactivo'
            }">
            <span class="w-1.5 h-1.5 rounded-full"
                [ngClass]="{'bg-green-500': status === 'Activo', 'bg-gray-400': status === 'Inactivo'}">
            </span>
            {{ status }}
        </span>
    </div>
</ng-template>

<!-- Actions Template -->
<ng-template #actionsTemplate let-item>
    <div class="flex items-center justify-center space-x-2">
        <!-- Requests Button (Moved here) -->
        <button
            class="hidden md:flex items-center justify-center px-2 py-1 rounded border border-[#00C895] text-[#00C895] hover:bg-green-50 transition-colors text-xs gap-1"
            title="Gestionar Solicitudes" (click)="openRequests(item); $event.stopPropagation()">
            <span class="font-bold">{{ item.requests || 0 }}</span>
            <app-universal-icon name="person-check" type="bootstrap" [size]="14"></app-universal-icon>
        </button>

        <!-- View Details -->
        <button
            class="flex items-center justify-center w-8 h-8 rounded-full border border-cyan-400 text-cyan-500 hover:bg-cyan-50 transition-colors"
            title="Ver detalles">
            <app-universal-icon name="eye" type="bootstrap" [size]="14"></app-universal-icon>
        </button>

        <!-- Edit -->
        <button
            class="flex items-center justify-center w-8 h-8 rounded-full border border-orange-400 text-orange-500 hover:bg-orange-50 transition-colors"
            title="Editar" (click)="openEditGroupForm(item)">
            <app-universal-icon name="pencil" type="bootstrap" [size]="14"></app-universal-icon>
        </button>

        <!-- Delete -->
        <button
            class="flex items-center justify-center w-8 h-8 rounded-full border border-red-400 text-red-500 hover:bg-red-50 transition-colors"
            title="Eliminar" (click)="deleteGroup(item.id)">
            <app-universal-icon name="trash" type="bootstrap" [size]="14"></app-universal-icon>
        </button>
    </div>
</ng-template>

<!-- Modals -->
<app-group-form [isOpen]="isNewGroupModalOpen" [group]="editingGroup" (close)="isNewGroupModalOpen = false"
    (saved)="onGroupSaved()">
</app-group-form>

<app-group-requests [isOpen]="isRequestsModalOpen" [group]="selectedRequestGroup" (close)="isRequestsModalOpen = false">
</app-group-requests>