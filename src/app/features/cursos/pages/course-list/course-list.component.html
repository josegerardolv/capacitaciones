<div class="min-h-screen">

    <!-- Tarjeta superior: título y breadcrumb -->
    <app-institutional-card [config]="{ showHeader: false, showFooter: false, showShadow: true, showBorder: true }"
        class="mb-6">
        <div class="flex items-center gap-4">
            <div class="p-3 rounded-lg bg-institucional-primario bg-opacity-10 flex items-center justify-center">
                <app-universal-icon name="book" type="material" class="w-6 h-6 text-white"></app-universal-icon>
            </div>

            <div class="min-w-0">
                <h1 class="text-2xl md:text-3xl font-extrabold text-gray-900">Cursos</h1>
                <p class="text-sm text-gray-500 mt-1">Gestiona los cursos</p>
            </div>
        </div>

        <div class="mt-2 ml-4">
            <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>
        </div>
    </app-institutional-card>
    <br>
    <!-- Tarjeta inferior: acciones, tabla y paginación -->
    <app-institutional-card [config]="{ showHeader: false, showFooter: false, showShadow: true, showBorder: true }">
        <!-- Toolbar: paginación superior y botón crear -->
        <div class="flex flex-col-reverse md:flex-row md:justify-between md:items-center gap-4">
            <app-table-pagination [config]="paginationConfig" [showPageSizeSelector]="true"
                [showPaginationControls]="false" (pageChange)="onPageChange($event)">
            </app-table-pagination>

            <div class="flex flex-col md:flex-row md:items-center gap-2">
                <app-institutional-button (buttonClick)="openForm()" [config]="{
                    variant: 'primary',
                    icon: 'add'
                }">
                    Nuevo Curso
                </app-institutional-button>
            </div>
        </div>

        <!-- buscar curso -->
        <div class="relative w-full md:w-96 mb-6">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <span class="material-symbols-outlined text-gray-400">search</span>
            </div>
            <input [formControl]="searchControl" type="text" placeholder="Buscar curso por nombre, tipo..."
                class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-institucional-primario focus:border-institucional-primario sm:text-sm transition duration-150 ease-in-out"
                autocomplete="off">
        </div>

        <!-- Tabla -->
        <app-institutional-table [data]="courses" [columns]="tableColumns" [config]="tableConfig">
        </app-institutional-table>
        <app-table-pagination [config]="paginationConfig" [showPageSizeSelector]="false" [showPaginationControls]="true"
            (pageChange)="onPageChange($event)">
        </app-table-pagination>
    </app-institutional-card>
</div>

<app-modal-form *ngIf="showModal && courseModalForm" [isOpen]="showModal"
    [title]="modalMode === 'create' ? 'Nuevo Curso' : 'Editar Curso'" (modalClose)="closeModal()"
    (formSubmit)="onModalSubmit()" [formGroup]="courseModalForm" [isLoading]="isSaving">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Nombre del curso -->
        <div class="col-span-1">
            <app-input-enhanced controlName="name" [control]="courseModalForm.get('name')" label="Nombre del curso"
                placeholder="Ingresa el nombre del curso" [required]="true">
            </app-input-enhanced>
        </div>

        <!-- Descripción del curso -->
        <div class="col-span-1">
            <app-input-enhanced controlName="description" [control]="courseModalForm.get('description')"
                label="Descripción del curso" placeholder="Ingresa la descripción del curso" [required]="true">
            </app-input-enhanced>
        </div>

        <!-- Tipo de curso -->
        <div class="col-span-1">
            <app-select controlName="courseTypeId" [control]="getControl('courseTypeId')" label="Tipo de curso"
                [options]="courseTypeOptions" placeholder="Seleccione tipo de curso">
            </app-select>
        </div>

        <!-- Duración -->
        <div class="col-span-1">
            <app-input-enhanced [type]="'number'" controlName="duration" [control]="courseModalForm.get('duration')"
                label="Duración (Minutos)" placeholder="Ingresa la duración del curso" [required]="true">
            </app-input-enhanced>
        </div>
    </div>
</app-modal-form>

<!-- Template para Acciones -->
<ng-template #actionsTemplate let-item>
    <div class="flex items-center justify-center space-x-3">
        <app-institutional-button [config]="{
                variant: 'info',
                size: 'small', 
                icon: 'list_alt',
                iconPosition: 'only'}" [appTooltip]="'Ver detalles'" tooltipPosition="top"
            (buttonClick)="viewGroups(item)">
        </app-institutional-button>
        <app-institutional-button [config]="{
                variant: 'warning',
                size: 'small', 
                icon: 'edit',
                iconPosition: 'only'}" [appTooltip]="'Editar'" tooltipPosition="top"
            (buttonClick)="openEditForm(item)">
        </app-institutional-button>
        <app-institutional-button [config]="{
                variant: 'danger',
                size: 'small', 
                icon: 'delete',
                iconPosition: 'only'}" [appTooltip]="'Eliminar'" tooltipPosition="top"
            (buttonClick)="deleteCourse(item.id)">
        </app-institutional-button>
    </div>
</ng-template>

<!-- Modales Genéricos -->
<app-confirmation-modal [isOpen]="isConfirmOpen" [config]="confirmConfig" (confirm)="onConfirmYes()"
    (cancel)="isConfirmOpen = false" (modalClose)="isConfirmOpen = false">
</app-confirmation-modal>